企业 OA







### 2021_09_01_10_30_52

- [ ] 把常量放到 model 中







------



# 一. 团队模块

## 1. 数据库表

1. 团队表

   ![image-20210805145930159](https://chy-cdn.oss-cn-hangzhou.aliyuncs.com/企业/企业_1628146770.png)

1. 团队成员表

   ![image-20210805145957302](https://chy-cdn.oss-cn-hangzhou.aliyuncs.com/企业/企业_1628146797.png)

3. 角色表
4. 权限表



## 2. 流程

### 创建团队

1. 输入名称和负责人真实姓名
2. 点击确认, 创建团队, 创建根部门, 插入团队成员(负责人, 部门属于根部门),创建根部门群(类型和子部门群不一样)
4. 生成团队二维码, 团队编号(供搜索使用)

> 团队名不唯一, 有认证标识(待定)  


### 添加团队成员  

- 邀请
  1. 由管理员输入信息 ( 真实姓名, 职位, 手机号, 入职时间, 所属部门 ( 只能选一个 ) ) 生成邀请二维码
  2. 员工扫码后点击同意, 添加团队成员

- 申请

  > 申请分为扫团队二维码和搜索团队编号  

  1. 输入真实姓名, 手机号和入职时间提交申请, 走审核流程
  2. 团队管理员同意后没有职位, 部门为根部门, 管理员再从后台进行设置
  
  默认都加入根部门群

### 更新团队信息

- 头像
- 名称
- 描述

### 解散团队

> 只有团队负责人可以解散团队
> 解散团队前需要解散所有成员和部门

### 转让团队负责人

> 只有团队负责人可以解散团队

1. 从团队管理员 ( 或者所有成员 ) 中选一个人成为负责人
2. 更新双方的 type

### 更新团队成员信息

> 一个成员只属于一个部门, 但可以担任多个部门的主管

- 团队身份 identity (负责人, 团队管理员, 客户管理员 ,普通人)
- 所属团队(不能更改)
- 所属部门()
- 职位
- 级别(主管, 普通)
- 真实姓名
- 手机号(显示信息 和登录无关)
- 邮箱(显示信息 和登录无关)
- 入职时间
- 状态 status (正常, 暂停)
- 城市
- 国家
- 人员类型 type (正式, 实习, 外包, 顾问, )
- 工号(显式的)

### 办理离职(从团队删除)

> 保留公私钥, 解除绑定
> 退出所有部门群

### 变更部门

加入部门, 会加入部门至根部门的所有群,

退出时也会退出所有群



## 3. 接口



# 二. 部门模块

## 1. 数据库表

1. 部门表

   ![image-20210805150016449](https://chy-cdn.oss-cn-hangzhou.aliyuncs.com/企业/企业_1628146816.png)

2. 部门群包装表

   ![image-20210805150027081](https://chy-cdn.oss-cn-hangzhou.aliyuncs.com/企业/企业_1628146827.png)

## 2. 流程

### 创建部门

1. 输入部门名称
2. 选择上级部门
3. 从团队成员中选一个当部门主管(不会影响成员原所属部门)
4. 选择是否创建群

### 删除部门

1. 删除部门前需要移除部门下的所有成员和子部门
2. 决定部门群是解散还是转为普通群



## 3. 接口





一个人可以属于多个团队

以下均为一个人在一个团队中

一个人只能属于一个部门

一个人可以成为多个部门的负责人

部门主管和部门负责人不是一个概念

一个人在团队中有几种身份




创建一个团队, 等于说在团队表创建了一行, 同时生成一个根部门, 同时创建一个团队群

在根部门下可以再创子部门, 最多 20 层, 每层 1000 个子部门, 子部门创建的群称为部门群, 无论多少层都叫部门群





# Docs

[在关系型数据库中优雅的处理组织架构树](https://juejin.cn/post/6844903906112176141)

1 邻接表
2 路径枚举



飞书后台

![image-20210804145611284](https://chy-cdn.oss-cn-hangzhou.aliyuncs.com/企业/企业_1628060171.png)

















# proto



## account

- 生成一个企业用户地址
- 绑定个人地址与企业地址
- 根据 personId 查询绑定信息
- 根据 personId 绑定的 uid 查询绑定信息



## apply

- 根据 entId 查询所有的申请列表
- 提交加入团队申请
- 提交退出团队申请
- 更新审批状态和审批人



## enterprise

- 生成企业
- 修改企业基本信息
- 解散企业(修改企业信息中的状态)
- 根据 entId 查询企业信息
- 更换负责人



## department

- 生成部门
- 根据 depId 查询 dep 信息
- 根据 parentId 找 subDep 列表
- 更新dep status
- 更新部门基本信息



## staff

- 生成员工
- 根据 path 查询 staff 列表 (区分 like 还是 ==)
- 根据 staffId 查询员工信息
- 更新 role(负责人, 管理员, 普通人)
- 批量根据 staffId 更新 staff.depId 和 path
- 更新 status(办理离职)
- 修改员工基本信息



## (group)

- 创建群







